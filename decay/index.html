<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>What is decay and array-to-pointer conversion? | C++ FAQ</title><meta name=keywords content><meta name=description content="When we call functions in C++, our arguments may need to undergo type conversions. For example, we can call a function that takes an int with a const int argument, which copies its value. For parameters which are passed by value, some of these conversions rules are called decay. They are called decay because in most cases, some type information is lost, such as the size of an array or the const qualifier in our example."><meta name=author content><link rel=canonical href=https://64.github.io/cpp-faq/decay/><link href=/cpp-faq/assets/css/stylesheet.min.746a86b58bb2b052b5e4df8216510494f04f81e62c08d626150c26c69ca929da.css integrity="sha256-dGqGtYuysFK15N+CFlEElPBPgeYsCNYmFQwmxpypKdo=" rel="preload stylesheet" as=style><link rel=icon href=https://64.github.io/cpp-faq/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://64.github.io/cpp-faq/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://64.github.io/cpp-faq/favicon-32x32.png><link rel=apple-touch-icon href=https://64.github.io/cpp-faq/apple-touch-icon.png><link rel=mask-icon href=https://64.github.io/cpp-faq/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><meta property="og:title" content="What is decay and array-to-pointer conversion?"><meta property="og:description" content="When we call functions in C++, our arguments may need to undergo type conversions. For example, we can call a function that takes an int with a const int argument, which copies its value. For parameters which are passed by value, some of these conversions rules are called decay. They are called decay because in most cases, some type information is lost, such as the size of an array or the const qualifier in our example."><meta property="og:type" content="article"><meta property="og:url" content="https://64.github.io/cpp-faq/decay/"><meta property="og:site_name" content="C++ FAQ"><meta name=twitter:card content="summary"><meta name=twitter:title content="What is decay and array-to-pointer conversion?"><meta name=twitter:description content="When we call functions in C++, our arguments may need to undergo type conversions. For example, we can call a function that takes an int with a const int argument, which copies its value. For parameters which are passed by value, some of these conversions rules are called decay. They are called decay because in most cases, some type information is lost, such as the size of an array or the const qualifier in our example."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Faqs","item":"https://64.github.io/cpp-faq/faq/"},{"@type":"ListItem","position":3,"name":"What is decay and array-to-pointer conversion?","item":"https://64.github.io/cpp-faq/decay/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"What is decay and array-to-pointer conversion?","name":"What is decay and array-to-pointer conversion?","description":"When we call functions in C++, our arguments may need to undergo type conversions. For example, we can call a function that takes an int with a const int argument, which copies its …","keywords":[""],"articleBody":"When we call functions in C++, our arguments may need to undergo type conversions. For example, we can call a function that takes an int with a const int argument, which copies its value. For parameters which are passed by value, some of these conversions rules are called decay. They are called decay because in most cases, some type information is lost, such as the size of an array or the const qualifier in our example.\nArray-to-Pointer Conversion A commonly known form of decay is array-to-pointer conversion:\n// We seemingly accept an array by value as our parameter: void print_size(char arr[128]) { // warning: 'sizeof' on array function parameter 'arr'  // will return size of 'char *' [-Wsizeof-array-argument]  std::cout  sizeof(arr)  '\\n'; } Sample output: 8\nWe have attempted to specify that our print_size should accept an array with size 128 of char by value as its function parameter. However, arrays cannot be passed by value and instead decay to pointers. So from the compiler’s point of view, our function signature is equal to:\nvoid print_size(char *arr); Using sizeof with arrays that have decayed to a pointer is a common source of bugs, as in the above example, where we obtain the size of a pointer, which is less than the size of the entire array. Thankfully, GCC and clang warn us about this.\nFunction-to-Pointer conversion Another very similar form of decay is function-to-pointer conversion:\nvoid call(void callback(int), int x) { callback(x); } Here, our first function parameter appears to be another function callback, which takes an int and returns nothing. However, just as an array, the function callback decays to a pointer. It would be equivalent to write:\nvoid call(void (*callback)(int), int x) { callback(x); } The danger of misuse is not as great here; decay simply gives us a nicer syntax for accepting function pointers.\nDiscarding const/volatile qualifiers and removing references This form of decay is something that you have likely understood already by intuition. When we accept a type T as a parameter to our function by value, we don’t care whether the arguments were const, volatile, references, other values, etc. Inside of the function, we are simply using T.\nThis form of decay can be seen in the following examples:\nvoid use_int(int my_int) { /* ... */ } int main() { // Calling use_int with a literal of type int:  use_int(3); // Calling use_int with a const volatile int: This copies the value of x.  // const and volatile are discarded, so inside of use_int,  // we don't care that the argument was const or volatile.  const volatile int x = 7; use_int(x); // Calling use_int with an int\u0026 copies the referenced value:  // Inside of use_int, we don't see or care that the argument was a reference.  int y = 5; int \u0026yref = y; use_int(y); } Using std::decay The documentation of the std::decay type trait lists all these decay conversions. std::decay can be used to simulate them and there is also a templated type alias std::decay_t for convenience. Here are a few examples:\n// no decay std::decay_tint - int // discarding references std::decay_tint\u0026 - int // discarding references and const qualifier std::decay_tconst int\u0026 - int // discarding volatile std::decay_tvolatile int - int // array-to-pointer std::decay_tint[8] - int* // array-to-pointer, and also discarding the reference std::decay_tint(\u0026)[8] - int* // function-to-pointer std::decay_tint(int) - int(*)(int) ","wordCount":"559","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://64.github.io/cpp-faq/decay/"},"publisher":{"@type":"Organization","name":"C++ FAQ","logo":{"@type":"ImageObject","url":"https://64.github.io/cpp-faq/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://64.github.io/cpp-faq accesskey=h title="C++ FAQ (Alt + H)">C++ FAQ</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>What is decay and array-to-pointer conversion?</h1><div class=post-meta><ul class=post-tags></ul></div></header><div class=post-content><p>When we call functions in C++, our arguments may need to undergo type conversions.
For example, we can call a function that takes an <code>int</code> with a <code>const int</code> argument, which copies its value.
For parameters which are passed by value, some of these conversions rules are called <em>decay</em>.
They are called <em>decay</em> because in most cases, some type information is lost, such as the size of an array or the
<code>const</code> qualifier in our example.</p><h2 id=array-to-pointer-conversion>Array-to-Pointer Conversion<a hidden class=anchor aria-hidden=true href=#array-to-pointer-conversion>#</a></h2><p>A commonly known form of decay is array-to-pointer conversion:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// We seemingly accept an array by value as our parameter:
</span><span style=color:#75715e></span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>print_size</span>(<span style=color:#66d9ef>char</span> arr[<span style=color:#ae81ff>128</span>]) {
    <span style=color:#75715e>// warning: &#39;sizeof&#39; on array function parameter &#39;arr&#39;
</span><span style=color:#75715e></span>    <span style=color:#75715e>//          will return size of &#39;char *&#39; [-Wsizeof-array-argument]
</span><span style=color:#75715e></span>    std<span style=color:#f92672>::</span>cout <span style=color:#f92672>&lt;&lt;</span> <span style=color:#66d9ef>sizeof</span>(arr) <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#39;\n&#39;</span>;
}
</code></pre></div><p><strong>Sample output:</strong> <code>8</code></p><p>We have attempted to specify that our <code>print_size</code> should accept an array with size <code>128</code> of <code>char</code> by value as its
function parameter.
However, arrays cannot be passed by value and instead decay to pointers.
So from the compiler&rsquo;s point of view, our function signature is equal to:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>print_size</span>(<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>arr);
</code></pre></div><p>Using <code>sizeof</code> with arrays that have decayed to a pointer is a common source of bugs, as in the above example, where
we obtain the size of a pointer, which is less than the size of the entire array.
Thankfully, GCC and clang warn us about this.</p><h2 id=function-to-pointer-conversion>Function-to-Pointer conversion<a hidden class=anchor aria-hidden=true href=#function-to-pointer-conversion>#</a></h2><p>Another very similar form of decay is function-to-pointer conversion:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>call</span>(<span style=color:#66d9ef>void</span> callback(<span style=color:#66d9ef>int</span>), <span style=color:#66d9ef>int</span> x) {
    callback(x);
}
</code></pre></div><p>Here, our first function parameter appears to be another function <code>callback</code>, which takes an <code>int</code> and returns nothing.
However, just as an array, the function <code>callback</code> decays to a pointer.
It would be equivalent to write:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>call</span>(<span style=color:#66d9ef>void</span> (<span style=color:#f92672>*</span>callback)(<span style=color:#66d9ef>int</span>), <span style=color:#66d9ef>int</span> x) {
    callback(x);
}
</code></pre></div><p>The danger of misuse is not as great here; decay simply gives us a nicer syntax for accepting function pointers.</p><h2 id=discarding-constvolatile-qualifiers-and-removing-references>Discarding <code>const</code>/<code>volatile</code> qualifiers and removing references<a hidden class=anchor aria-hidden=true href=#discarding-constvolatile-qualifiers-and-removing-references>#</a></h2><p>This form of decay is something that you have likely understood already by intuition.
When we accept a type <code>T</code> as a parameter to our function by value, we don&rsquo;t care whether the arguments were <code>const</code>,
<code>volatile</code>, references, other values, etc.
Inside of the function, we are simply using <code>T</code>.</p><p>This form of decay can be seen in the following examples:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>use_int</span>(<span style=color:#66d9ef>int</span> my_int) {
    <span style=color:#75715e>/* ... */</span>
}

<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
    <span style=color:#75715e>// Calling use_int with a literal of type int:
</span><span style=color:#75715e></span>    use_int(<span style=color:#ae81ff>3</span>);
    
    <span style=color:#75715e>// Calling use_int with a const volatile int: This copies the value of x.
</span><span style=color:#75715e></span>    <span style=color:#75715e>// const and volatile are discarded, so inside of use_int,
</span><span style=color:#75715e></span>    <span style=color:#75715e>// we don&#39;t care that the argument was const or volatile.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>int</span> x <span style=color:#f92672>=</span> <span style=color:#ae81ff>7</span>;
    use_int(x);
    
    <span style=color:#75715e>// Calling use_int with an int&amp; copies the referenced value:
</span><span style=color:#75715e></span>    <span style=color:#75715e>// Inside of use_int, we don&#39;t see or care that the argument was a reference.
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> y <span style=color:#f92672>=</span> <span style=color:#ae81ff>5</span>;
    <span style=color:#66d9ef>int</span> <span style=color:#f92672>&amp;</span>yref <span style=color:#f92672>=</span> y;
    use_int(y);
}
</code></pre></div><h2 id=using-stddecay>Using <code>std::decay</code><a hidden class=anchor aria-hidden=true href=#using-stddecay>#</a></h2><p>The documentation of the <a href=https://en.cppreference.com/w/cpp/types/decay><code>std::decay</code></a> type trait lists all these
<em>decay</em> conversions.
<code>std::decay</code> can be used to simulate them and there is also a templated type alias <code>std::decay_t</code> for convenience.
Here are a few examples:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#75715e>// no decay
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>           <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span>  
<span style=color:#75715e>// discarding references
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&amp;&gt;</span>          <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span>  
<span style=color:#75715e>// discarding references and const qualifier
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>const</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>&amp;&gt;</span>    <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span>
<span style=color:#75715e>// discarding volatile
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>volatile</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>  <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span>
<span style=color:#75715e>// array-to-pointer
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span>[<span style=color:#ae81ff>8</span>]<span style=color:#f92672>&gt;</span>        <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>*</span>
<span style=color:#75715e>// array-to-pointer, and also discarding the reference
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span>(<span style=color:#f92672>&amp;</span>)[<span style=color:#ae81ff>8</span>]<span style=color:#f92672>&gt;</span>     <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span><span style=color:#f92672>*</span>
<span style=color:#75715e>// function-to-pointer
</span><span style=color:#75715e></span>std<span style=color:#f92672>::</span>decay_t<span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span>(<span style=color:#66d9ef>int</span>)<span style=color:#f92672>&gt;</span>      <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>int</span>(<span style=color:#f92672>*</span>)(<span style=color:#66d9ef>int</span>)
</code></pre></div></div><footer class=post-footer></footer></article></main><footer class=footer><span>&copy; 2021 <a href=https://64.github.io/cpp-faq>C++ FAQ</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/cpp-faq/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>